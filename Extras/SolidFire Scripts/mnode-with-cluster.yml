---
name: ReserveClusterMnode
spec:
  build:
    thisBuild:
      info:
        element: magnesium
        repository: magnesium-patch5
        version: 12.5.0.897
      type: element
  resource_requirements:
    filter:
      match_attributes:
        location: WIC
      match_metadata:
        lab: SF_Sustaining
        resource_pool: CPE_WIC
    ondemand_resource_types:
      mnode:
      - config:
          hypervisor_type: esx
          payload:
            vm_config:
              image_url: http://pw-jenkins.eng.solidfire.net/OVA/solidfire-fdva-magnesium-patch5-12.5.0.897.ova
              vm_identifier: CPE-mnode-cluster
        name: mynode_vcenter1
        parallel: true
    resource_types:
      ip_address:
      - count: 1
        filter:
          match_attributes:
            $subnet.label: storage
        name: storageVip
      - count: 1
        filter:
          match_attributes:
            $subnet.label: management
        name: managementVip
      storage_node:
      - count: 1
        filter:
          match_expressions:
          - attribute_name: model
            operator: In
            values:
            - H610S-1
        name: storageNodes
      compute_node:
      - name: computeNode
        count: 1
        filter:
         match_attributes:
           model: H615C-A4231
  setup:
    stages:
    - name: setupNodesStage
      parallel: true
      tasks:
      - config:
          rtfi_params:
            cluster_name: CPE_learning_mNode
            sf_bond_mode_10g: LACP
            sf_inplace: false
            sf_nic_Method: static
          skip_post_rtfi_network: false
        name: setupStorageNodesTask
        refs:
          build: thisBuild
          node: storageNodes
        type: provision_storage_node
    - name: createClusterStage
      tasks:
      - config:
          cluster_name: CPE_WIC_Cluster
          ntp_servers:
          - bigben.eng.netapp.com
          - ntp1.den.solidfire.net
        name: createStorageClusterTask
        refs:
          cluster_mvip_name: managementVip
          cluster_svip_name: storageVip
          mnode: mynode_vcenter1
          provision_tasks:
          - setupStorageNodesTask
        type: create_storage_cluster
type: Reservation
