---
name: ReserveClusterupgrade
spec:
  build:
    storageNodeBuild:
      info:
        element: sodium
        repository: sodium-patch5
        version: 11.5.1.6
      type: element 
  resource_requirements:
    filter:
      match_attributes:
          location: WIC
      match_metadata:
          lab: SF_Sustaining
          resource_pool: CPE_WIC
    resource_types:
      storage_node:
        - name: storageNodes
          count: 3
          filter:
            match_expressions:
              - attribute_name: model
                operator: In
                values:
                  - H410S-1
      ip_address:
        - name: storageVip
          count: 1
          filter:
            match_attributes:
              $subnet.label: storage
        - name: managementVip
          count: 1
          filter:
            match_attributes:
              $subnet.label: management
  setup:
    stages:
      - name: setupNodesStage
        tasks:
          - config:
              rtfi_params:
                sf_inplace: false
                sf_bond_mode_10g: LACP
              skip_post_rtfi_network: false
            name: setupStorageNodesTask
            refs:
              build: storageNodeBuild
              node: storageNodes
            type: provision_storage_node
      - name: createClusterStage
        tasks:
          - config:
              cluster_name: Testupgrade
              ntp_servers:
              - ntp.solidfire.net
              - bigben.eng.netapp.com
            name: createStorageClusterTask
            refs:
              cluster_mvip_name: managementVip
              cluster_svip_name: storageVip
              provision_tasks:
                - setupStorageNodesTask
            type: create_storage_cluster
