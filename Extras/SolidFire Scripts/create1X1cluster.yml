---
name: HCISetupTesting
spec:
  build:
    computeNodeBuild:
      info:
        element: ember
        repository: solidfire-compute
        version: 12.5.0.897
      type: element
    storageNodeBuild:
      info:
        element: magnesium
        repository: magnesium-patch5
        version: 12.5.0.897
      type: element
  resource_requirements:
    filter:
      match_attributes:
        location: WIC
      match_metadata:
        lab: SF_Sustaining
        resource_pool: CPE_WIC
    resource_types:
      client:
      - count: 1
        name: client1
      compute_node:
      - count: 1
        filter:
          match_expressions:
          - attribute_name: model
            operator: In
            values:
            - H615C-A4231
        name: computeNodes
      ip_address:
      - count: 1
        filter:
          match_attributes:
            $subnet.label: storage
        name: storageVip
      - count: 1
        filter:
          match_attributes:
            $subnet.label: management
        name: managementVip
      storage_node:
      - count: 1
        filter:
          match_expressions:
          - attribute_name: model
            operator: In
            values:
            - H410S-1
        name: storageNodes
  setup:
    stages:
    - name: setupNodesStage
      tasks:
      - config:
          rtfi_params:
            sf_bond_mode_10g: LACP
            sf_inplace: false
          skip_post_rtfi_network: false
        name: setupStorageNodesTask
        refs:
          build: storageNodeBuild
          node: storageNodes
        type: provision_storage_node
    - name: setupComputeStage
      tasks:
      - config:
          rtfi_params:
            sf_inplace: false
          skip_post_rtfi_network: true
        name: setupComputeNodesTask
        refs:
          build: computeNodeBuild
          node: computeNodes
        type: provision_compute_node
    - name: createClusterStage
      tasks:
      - config:
          cluster_name: HCISetupTestingCluster
        name: createStorageClusterTask
        refs:
          cluster_mvip_name: managementVip
          cluster_svip_name: storageVip
          provision_tasks:
          - setupStorageNodesTask
        type: create_storage_cluster
